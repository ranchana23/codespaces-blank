<!doctype html>
<html lang="th">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Remove Corners ‚Äî Preview & Download</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai+Looped:wght@300;400;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #FDFBF7;
      --card: #FFFFFF;
      --text: #4A4A4A;
      --muted: #8898AA;
      --primary: #AEC6CF;
      /* Pastel Blue */
      --primary-hover: #9AB5BF;
      --secondary: #FFB7B2;
      /* Pastel Pink */
      --secondary-hover: #EFA6A1;
      --border: #F0F0F0;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: 'Noto Sans Thai Looped', 'Noto Sans Thai', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .wrap {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    h1 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.5px;
    }

    p.lead {
      margin: 0 0 32px;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.6;
    }

    .controls {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 32px;
      align-items: center;
      background: #FAFAFA;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    input[type=file] {
      display: block;
      font-size: 14px;
      color: var(--muted);
    }

    input[type=file]::file-selector-button {
      background: #fff;
      border: 1px solid var(--border);
      padding: 8px 16px;
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      margin-right: 12px;
      transition: all 0.2s;
    }

    input[type=file]::file-selector-button:hover {
      background: #f5f5f5;
    }

    .btn {
      background: var(--primary);
      color: #fff;
      padding: 10px 20px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(174, 198, 207, 0.3);
    }

    .btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.secondary {
      background: var(--secondary);
      box-shadow: 0 4px 12px rgba(255, 183, 178, 0.3);
    }

    .btn.secondary:hover {
      background: var(--secondary-hover);
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 32px;
    }

    .thumb {
      background: #fff;
      border-radius: 16px;
      padding: 12px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
    }

    .thumb:hover {
      transform: translateY(-2px);
    }

    .thumb img {
      width: 100%;
      height: 140px;
      border-radius: 12px;
      object-fit: contain;
      background: repeating-conic-gradient(#f8f9fb 0% 25%, transparent 0% 50%) 50% / 20px 20px;
    }

    .thumb .meta {
      font-size: 13px;
      color: var(--muted);
      margin-top: 12px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .thumb .actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      width: 100%;
    }

    .thumb .actions .btn {
      width: 100%;
      padding: 8px;
      font-size: 12px;
    }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    input[type="number"] {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      width: 80px;
      font-family: inherit;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="number"]:focus {
      border-color: var(--primary);
    }

    footer {
      margin-top: 40px;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
      opacity: 0.7;
    }

    .upload-area {
      border: 2px dashed #E0E0E0;
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #FAFAFA;
      margin-bottom: 32px;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: #F0F7FA;
    }

    .upload-area.dragover {
      border-color: var(--primary);
      background: #E6F2F7;
      transform: scale(1.01);
    }
  </style>
</head>

<body>
  <div class="wrap card">
    <h1>Remove Corners ‚Äî Preview & Download</h1>
    <p class="lead">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ (‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ) ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏° (radius) ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>

    <div class="upload-area" id="uploadArea">
      <div style="font-size: 48px; margin-bottom: 16px;">üìÅ</div>
      <p style="margin: 0; font-size: 16px; font-weight: 600; color: var(--text);">Click to Upload or Drag & Drop</p>
      <p style="margin: 8px 0 0; font-size: 13px; color: var(--muted);">Supports: JPG, PNG, WEBP</p>
    </div>

    <input id="files" type="file" accept="image/*" multiple style="display: none;" />

    <div class="controls">
      <label class="row">
        <span style="margin-right:8px">Radius:</span>
        <input id="radius" type="number" value="90" min="0"
          style="width:80px;padding:6px;border-radius:6px;border:1px solid #e6eef0" />
      </label>
      <button id="previewBtn" class="btn small">Preview</button>
      <button id="downloadAllBtn" class="btn small">Download All (.zip)</button>
    </div>

    <div id="gallery" class="gallery" aria-live="polite"></div>

    <footer>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô PNG ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ (alpha) ‚Äî ‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö canvas</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script>
    const filesInput = document.getElementById('files');
    const previewBtn = document.getElementById('previewBtn');
    const radiusInput = document.getElementById('radius');
    const gallery = document.getElementById('gallery');
    const downloadAllBtn = document.getElementById('downloadAllBtn');

    const uploadArea = document.getElementById('uploadArea');

    let files = [];

    // Handle file selection via input
    filesInput.addEventListener('change', e => {
      handleFiles(Array.from(e.target.files));
    });

    // Handle click on upload area
    uploadArea.addEventListener('click', () => filesInput.click());

    // Handle drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
    });

    uploadArea.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const droppedFiles = Array.from(dt.files);
      handleFiles(droppedFiles);
    });

    function handleFiles(newFiles) {
      files = newFiles;
      // Optional: Update UI to show selected file count
      if (files.length > 0) {
        const text = files.length === 1 ? files[0].name : `${files.length} files selected`;
        uploadArea.querySelector('p').textContent = text;
        uploadArea.querySelector('div').textContent = '‚úÖ';
      }
    }

    function loadImageFromFile(file) {
      return new Promise((res, rej) => {
        const reader = new FileReader();
        reader.onload = () => {
          const img = new Image();
          img.onload = () => res(img);
          img.onerror = rej;
          img.src = reader.result;
        };
        reader.onerror = rej;
        reader.readAsDataURL(file);
      });
    }

    function roundedCanvasForImage(img, r) {
      const canvas = document.createElement('canvas');
      const w = img.width, h = img.height;
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      const rad = Math.max(0, Math.min(r, Math.min(w, h) / 2));
      ctx.clearRect(0, 0, w, h);
      // rounded rect path
      ctx.beginPath();
      ctx.moveTo(rad, 0);
      ctx.lineTo(w - rad, 0);
      ctx.quadraticCurveTo(w, 0, w, rad);
      ctx.lineTo(w, h - rad);
      ctx.quadraticCurveTo(w, h, w - rad, h);
      ctx.lineTo(rad, h);
      ctx.quadraticCurveTo(0, h, 0, h - rad);
      ctx.lineTo(0, rad);
      ctx.quadraticCurveTo(0, 0, rad, 0);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(img, 0, 0, w, h);
      return canvas;
    }

    async function makePreviewForFile(file, r) {
      const img = await loadImageFromFile(file);
      const canvas = roundedCanvasForImage(img, r);
      return new Promise(resolve => canvas.toBlob(blob => resolve({ blob, width: img.width, height: img.height }), 'image/png'));
    }

    function clearGallery() { gallery.innerHTML = ''; }

    previewBtn.addEventListener('click', async () => {
      if (!files.length) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
      clearGallery();
      const r = parseInt(radiusInput.value || 0, 10);
      for (const f of files) {
        const holder = document.createElement('div'); holder.className = 'thumb';
        const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = f.name;
        const imgEl = document.createElement('img'); imgEl.alt = f.name;
        holder.appendChild(imgEl);
        gallery.appendChild(holder);
        try {
          const { blob, width, height } = await makePreviewForFile(f, r);
          const url = URL.createObjectURL(blob);
          imgEl.src = url;
          const m = document.createElement('div'); m.className = 'meta'; m.textContent = `${width}√ó${height}`;
          holder.appendChild(m);
          const actions = document.createElement('div'); actions.className = 'actions';
          const dl = document.createElement('button'); dl.className = 'btn secondary small'; dl.textContent = 'Download';
          dl.addEventListener('click', () => {
            const a = document.createElement('a');
            a.href = url; a.download = f.name.replace(/\.[^.]+$/, '') + '_rounded.png';
            a.click();
          });
          actions.appendChild(dl);
          holder.appendChild(actions);
          // store blob on element for zip
          holder._blob = blob; holder._name = f.name;
        } catch (err) {
          const e = document.createElement('div'); e.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ'; e.style.color = 'crimson'; holder.appendChild(e);
        }
      }
    });

    downloadAllBtn.addEventListener('click', async () => {
      if (!gallery.children.length) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‚Äî ‡∏Ñ‡∏•‡∏¥‡∏Å Preview ‡∏Å‡πà‡∏≠‡∏ô');
      const zip = new JSZip();
      let added = 0;
      for (const child of Array.from(gallery.children)) {
        const blob = child._blob; const name = child._name || ('image' + (added + 1));
        if (blob) { zip.file(name.replace(/\.[^.]+$/, '') + '_rounded.png', blob); added++; }
      }
      if (!added) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ');
      downloadAllBtn.textContent = 'Preparing...'; downloadAllBtn.disabled = true;
      const zblob = await zip.generateAsync({ type: 'blob' });
      const url = URL.createObjectURL(zblob);
      const a = document.createElement('a'); a.href = url; a.download = 'rounded_images.zip'; a.click();
      setTimeout(() => { URL.revokeObjectURL(url); downloadAllBtn.textContent = 'Download All (.zip)'; downloadAllBtn.disabled = false }, 1500);
    });
  </script>
</body>

</html>